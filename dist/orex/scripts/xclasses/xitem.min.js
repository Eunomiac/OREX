import{gsap as t,U as e,DB as i,XElem as s}from"../helpers/bundler.js";export default class r extends Application{constructor(t,{t:i=[],...n}){n.i||(n.id+=e.h()),super(n),this.o=!1,this.u=new Set,this.l=new Set,this.options.t.push(...i),this.g=Object.assign(n,this.options),this.p=null===t?null:t??r.m,this.P=new s({A:this,R:this.g.R})}static get k(){return e.O(super.k,{T:!1,t:["x-item"],X:e.K("xitem"),j:r.m,R:{set:{x:0,y:0,rotation:0,scale:1,I:-50,S:-50,transformOrigin:"50% 50%"}}})}static get m(){return r.$}static async C(){return r.m&&r.m.D(),r.$=new r(null,{id:"x-root",i:!0,R:{set:{I:0,S:0}}}),r.$.initialize()}static G(e){r.v.add(e),t.F.add(e)}static H(e){r.v.delete(e),t.F.remove(e)}static get L(){return this.U=this.U??(()=>{this.q.forEach((e=>{e.set({rotation:-1*t.B.wrap(0,360,e.global.rotation)})}))})}static J(t){(t=[t].flat()).length&&t.some((t=>!this.q.includes(t)))&&(this.U&&this.H(this.U),this.q=e.unique([...this.q,...t]),this.G(this.L))}static M(t){if((t=[t].flat()).length&&t.some((t=>this.q.includes(t)))){this.U&&this.H(this.U);const e=t.map((t=>t.id));this.q=this.q.filter((t=>!e.includes(t.id))),this.q.length&&this.G(this.L)}}get N(){return this.P.N}get V(){return this.P.V}get j(){return this.p}set j(t){this.p=t??r.m}get W(){return this.u}get Y(){return this.W.size>0}Z(t){t.j=this,this.W.add(t)}_(t){this.W.delete(t)}tt(t,i=!1){const s=Array.from(this.W.values()).flat().filter(e.et(t));return i&&s.push(...Array.from(this.W.values()).map((e=>e.tt(t,!0))).flat()),s}async initialize(){return this.it?Promise.resolve(!0):await this.P.st(!0)?Promise.allSettled(this.tt(r).map((t=>t.initialize()))).then((()=>(this.o=!0,Promise.resolve(!0))),(()=>Promise.resolve(!1))):Promise.resolve(!1)}get rt(){return this.nt}get it(){return this.o}get x(){return this.P.x}get y(){return this.P.y}get ht(){return this.P.ht}get rotation(){return this.P.rotation}get scale(){return this.P.scale}get global(){return this.P.global}get height(){return this.P.height}get width(){return this.P.width}get size(){return this.P.size}get ot(){return this.P.ot}get st(){return this.P.st.bind(this.P)}get ut(){return this.P.ut.bind(this.P)}ct(e){this.l.add(e),t.F.add(e)}lt(e){this.l.delete(e),t.F.remove(e)}get set(){return this.P.set.bind(this.P)}get to(){return this.P.to.bind(this.P)}get from(){return this.P.from.bind(this.P)}get gt(){return this.P.gt.bind(this.P)}D(){this.Y&&this.tt(r).forEach((t=>t.D())),this.l.forEach((e=>t.F.remove(e))),this.l.clear(),this.j instanceof r&&this.j._(this),this.rt&&(t.dt(this.N),this.V.remove())}getData(){const t=super.getData();return Object.assign(t,{id:this.id,t:this.options.t.join(" ")}),t}async Pt(){if(!this.P.xt)return i.error("Attempt to render an unready Application"),Promise.resolve(!1);try{return await this.yt(!0,{}),Promise.resolve(!0)}catch(t){return this.At=Application.RENDER_STATES.ERROR,Hooks.onError("Application#render",t,{Rt:`An error occurred while rendering ${this.constructor.name} ${this.ft}`,log:"error"}),Promise.resolve(!1)}}}r.v=new Set,r.q=[];
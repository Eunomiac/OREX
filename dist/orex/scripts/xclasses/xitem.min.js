import{gsap as t,U as e,DB as i,XElem as s,XGroup as r}from"../helpers/bundler.js";export default class n extends Application{static get t(){return e.i(super.t,{h:!1,o:["x-item"],u:e.g("xitem"),l:n.p,m:{set:{x:0,y:0,rotation:0,scale:1,P:-50,O:-50,transformOrigin:"50% 50%"}}})}static#t;static get p(){return n.#t}static async R(){return n.p&&n.p.A(),n.#t=new n(null,{id:"XROOT",m:{set:{P:0,O:0}}}),n.#t.initialize()}static T=new Map;static X(t){this.T.set(t.id,t)}static k(t){this.T.delete("string"==typeof t?t:t.id)}static D(){return Array.from(this.T.values())}static K(t){return!!this.T.has(t.id)&&this.T.get(t.id)}static#e=Date.now();static#i={x:0,y:0};static $(t,e){Date.now()-this.#e>1e3&&(this.#e=Date.now(),this.#i={x:t,y:e}),this.D().filter((t=>t instanceof r&&t.l===n.p)).forEach((t=>{}))}#s=!1;#r;#n=new Set;G;I;get M(){return this.I.M}get j(){return this.I.j}get l(){return this.#r}set l(t){this.#r=t??n.p}get S(){return this.#n}get v(){return this.S.size>0}U(t){t.l=this,this.S.add(t)}C(t){this.S.delete(t)}F(t,i=!1){const s=Array.from(this.S.values()).flat().filter(e.H(t));return i&&s.push(...Array.from(this.S.values()).map((e=>e.F(t,!0))).flat()),s}constructor(t,{o:i=[],...r}){t&&(r.id=e.L(`${t.id}-${r.id}`.replace(/^X?ROOT-?/,"X-"))),super(r),this.options.o.push(...i),this.G=Object.assign(r,this.options),this.#r=null===t?null:t??n.p,this.I=new s(this,{m:this.G.m}),this.constructor.X(this)}async initialize(){return this.Y?Promise.resolve(!0):await this.I._(!0)?Promise.allSettled(this.F(n).map((t=>t.initialize()))).then((()=>(this.#s=!0,Promise.resolve(!0))),(()=>Promise.resolve(!1))):Promise.resolve(!1)}get q(){return this.B}get Y(){return this.#s}get x(){return this.I.x}get y(){return this.I.y}get J(){return this.I.J}get rotation(){return this.I.rotation}get scale(){return this.I.scale}get global(){return this.I.global}get height(){return this.I.height}get width(){return this.I.width}get size(){return this.I.size}get N(){return this.I.N}get V(){return this.I.V.bind(this.I)}get W(){return this.I.W.bind(this.I)}get _(){return this.I._.bind(this.I)}get Z(){return this.I.Z.bind(this.I)}tt=new Set;et(e){this.tt.add(e),t.it.add(e)}st(e){this.tt.delete(e),t.it.remove(e)}get set(){return this.I.set.bind(this.I)}get to(){return this.I.to.bind(this.I)}get from(){return this.I.from.bind(this.I)}get rt(){return this.I.rt.bind(this.I)}A(){this.v&&this.F(n).forEach((t=>t.A())),this.tt.forEach((e=>t.it.remove(e))),this.tt.clear(),this.l instanceof n&&this.l.C(this),this.q&&(t.nt(this.M),this.j.remove())}getData(){const t=super.getData();return Object.assign(t,{id:this.id,o:this.options.o.join(" ")}),t}async ht(){if(!this.I.ot)return i.error("Attempt to render an unready Application"),Promise.resolve(!1);try{return await this.ut(!0,{}),Promise.resolve(!0)}catch(t){return this.ct=Application.RENDER_STATES.ERROR,Hooks.onError("Application#render",t,{gt:`An error occurred while rendering ${this.constructor.name} ${this.lt}`,log:"error"}),Promise.resolve(!1)}}}
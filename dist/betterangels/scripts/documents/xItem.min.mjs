/* ▌██░░ betterangels v0.0.1-prealpha (2021) ║ MIT License ║ https://github.com/Eunomiac/betterangels ░░██▐ */class XItem{static get REGISTRY(){return this._REGISTRY=this._REGISTRY??{}}static get TYPES(){return{basic:"basic",openSpace:"slot-space"}}static Register(e){this.REGISTRY[e.name]=e}static Unregister(e){delete this.REGISTRY[e.name]}constructor(e,t,i){if(t=t??i?.type??XItem.TYPES.basic,!Object.values(XItem.TYPES).includes(t))throw new Error(`Invalid Die Type: ${t}`);this._type=t,this._owner=i?.owner??e.owner.id;const s=new RegExp(`${this._owner}_${this._type}_`);this._name=`${this._owner}_${this._type}_${Object.keys(XItem.REGISTRY).filter((e=>s.test(e))).length+1}`,XItem.Register(this),this._create(),this.circle=e,this._createDragger()}get x(){return gsap.getProperty(this.elem,"x")}get y(){return gsap.getProperty(this.elem,"y")}get rotation(){return gsap.getProperty(this.elem,"rotation")}get owner(){return game.users.get(this._owner)}get name(){return this._name}get id(){return`die-${this.name}`}get elem(){return this._elem}get sel(){return`#${this.id}`}get parent(){return this._parent}set parent(e){const[t]=$(`#${e?.id??"noElemFound"}`);if(t){const{x:i,y:s}=MotionPathPlugin.convertCoordinates(this.parent?.elem??this.parent??this.elem,t,{x:this.x,y:this.y});this._parent=e,this.set({x:i,y:s}),$(this.elem).appendTo(t),this.straighten(),this.dragger&&this.dragger.update(!1,this.isDragging)}}get circle(){return this.parent instanceof RollCircle?this.parent:void 0}set circle(e){if(!(e instanceof RollCircle))throw new Error(`'${e}' is not a RollCircle`);this.parent=e}get snapPoints(){return this.circle?.snap.points}get dragger(){return this._dragger}get isThrowing(){return this.dragger?.isThrowing}get isDragging(){return this._isDragging&&!this.isThrowing}get isMoving(){return this.isDragging||this.isThrowing}get homeCircle(){return this._homeCircle}get type(){return this._type}set type(e){$(this.sel).removeClass(`ore-${this.type}`).addClass(`ore-${e}`),this._type=e}_create(){[this._elem]=$(`<div id="${this.id}" class="ore-die ore-${this.type}">X</div>`).appendTo(RollCircle.CONTAINER),this.set({xPercent:-50,yPercent:-50})}_createDragger(){[this._dragger]=Dragger.create(this.elem,{type:"x,y",inertia:!0,callbackScope:this,minDuration:2,throwResistance:100,onDragStart(){this._isDragging=!0,this.closestCircle=this.circle??RollCircle.GetClosestTo(this),this.parent=RollCircle.CONTAINER,this.closestCircle.pluckDie(this)},onDrag(){const e=RollCircle.GetClosestTo(this);e?.name!==this.closestCircle?.name&&(this.closestCircle.unreadyDie(this),this.closestCircle=e,this.closestCircle.readyDie(this))},snap:{get points(){return RollCircle.SnapPoints}},onDragEnd(){this._isDragging=!1;const e=RollCircle.GetClosestTo({x:this.dragger.endX,y:this.dragger.endY});e?.name!==this.closestCircle?.name&&(this.closestCircle.unreadyDie(this),this.closestCircle=e,this.closestCircle.readyDie(this)),this.closestCircle.catchDie(this)}})}set(e){gsap.set(this.elem,e)}kill(){XItem.Unregister(this),$(`#${this.id}`).remove()}straighten(){this.circle?gsap.set(this.elem,{rotation:-1*this.circle.rotation}):gsap.set(this.elem,{rotation:0})}}